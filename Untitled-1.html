<!DOCTYPE html>
<html lang="ar" dir="rtl">
    
<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="yt0mMNlZRexZeiF3yIGCpv8LCchODtPw5in35CXSYq0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø·Ø§Ù„Ø¨Ø§Øª </title>

  <script type="module">
    /**
     * @file Firebase Initialization Script for MHE_DEV_emla-a
     * @description ÙŠÙ‚ÙˆÙ… Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø¨ØªÙ‡ÙŠØ¦Ø© ØªØ·Ø¨ÙŠÙ‚ Firebase Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© 
     * ÙˆÙŠØ¬Ø¹Ù„ ÙƒØ§Ø¦Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ (Global/Window).
     * ÙŠØ³ØªØ®Ø¯Ù… Ø£Ø­Ø¯Ø« Ø¥ØµØ¯Ø§Ø± Ù…Ù† Ù…ÙƒØªØ¨Ø§Øª Firebase (CDN).
     */

    // 1. Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…Ù† Ø±ÙˆØ§Ø¨Ø· Firebase Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ (Ø£Ø­Ø¯Ø« Ø¥ØµØ¯Ø§Ø± Ù…Ø³ØªÙ‚Ø±)
    // ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± (Ù…Ø«Ù„ 10.11.0) Ø¥Ø°Ø§ ØµØ¯Ø± Ø¥ØµØ¯Ø§Ø± Ø£Ø­Ø¯Ø« Ø¨ÙƒØ«ÙŠØ±.
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-analytics.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js"; // Realtime Database
    import { getFirestore } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js"; // Firestore (Ù…ÙØ¶Ø§ÙØ© Ù„Ù…Ø±ÙˆÙ†Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…)

    // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
    const MHE_FIREBASE_CONFIG = {
      apiKey: "AIzaSyACiyGBido2jG9uwFSr1GX1oT62RdmOKWc",
      authDomain: "emla-a.firebaseapp.com",
      projectId: "emla-a",
      storageBucket: "emla-a.firebasestorage.app",
      messagingSenderId: "134112556225",
      appId: "1:134112556225:web:2f3427980c590cdfa7d040",
      measurementId: "G-0EQJQMCF67"
    };

    /**
     * @function initializeFirebaseApp
     * @description ØªÙ‡ÙŠØ¦Ø© ØªØ·Ø¨ÙŠÙ‚ Firebase ÙˆØ®Ø¯Ù…Ø§ØªÙ‡.
     * @returns {void}
     */
    function initializeFirebaseApp() {
        try {
            // Ø£. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
            const app = initializeApp(MHE_FIREBASE_CONFIG);
            
            // Ø¨. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ¬Ø¹Ù„Ù‡Ø§ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ (Global)
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… window.SERVICE_NAME Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù…Ù† Ø£ÙŠ Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØµÙØ­Ø©
            window.firebaseApp = app;
            window.firebaseAuth = getAuth(app);
            window.firebaseDatabase = getDatabase(app);
            window.firebaseFirestore = getFirestore(app);
            window.firebaseAnalytics = getAnalytics(app);
            
            console.log("âœ… Firebase services initialized successfully for 'emla-a'.");

        } catch (error) {
            // Ø¬. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù‚ÙˆÙŠØ© (Robust Error Handling)
            console.error("âŒ Firebase Initialization Failed:", error);
            // Ù‚Ø¯ ØªØ±ØºØ¨ Ù‡Ù†Ø§ ÙÙŠ Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ø¯Ù…Ø© Ø¶Ø±ÙˆØ±ÙŠØ©
            alert("ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø®Ø¯Ù…Ø§Øª Firebase. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.");
        }
    }

    // ØªØ´ØºÙŠÙ„ Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª
    initializeFirebaseApp();
    
    // Ù…Ø«Ø§Ù„ Ø¨Ø³ÙŠØ· Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°ÙÙ‡):
    /*
    setTimeout(() => {
        if (window.firebaseAuth) {
            console.log("Auth Service Ready:", window.firebaseAuth);
        }
    }, 2000);
    */

</script>


    <meta name="description" content="Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø·Ø§Ù„Ø¨Ø§Øª ">
     <meta name="description" content="emlaa">
      <meta name="description" content="Marwan Hany EL-Nagar">
    <link rel="stylesheet" href="styles.css">
  
    

    <link rel="icon" type="image/x-icon" href="aikona.png">
    <!-- Ø®Ø·ÙˆØ· Ø¹Ø±Ø¨ÙŠØ© Ù…Ø­Ø³Ù†Ø© Ù„Ù„ÙˆØ¶ÙˆØ­ ÙˆØ§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Changa:wght@400;700&display=swap" rel="stylesheet">
    <!-- ØªØ­Ù…ÙŠÙ„ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

   
    
    <style>

        
    
        
        /* ====================================================================== */
        /* Ø§Ù„Ù‚Ø³Ù… 1: Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø«ÙŠÙ…Ø§Øª (Default: Dark Blue) */
        /* ====================================================================== */
        :root {
            /* Default: Dark Blue Theme */
            --primary-color: #3498db; 
            --secondary-color: #2ecc71; 
            --accent-color: #f1c40f; 
            --error-color: #e74c3c; 
            --bg-color: #1a1a1a; 
            --text-color: #ecf0f1; 
            --container-bg: #2c3e50; 
            --card-bg: #34495e; 
            --table-header-bg: #4a627a;
            --table-row-hover: #3e5268;
            --button-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
            --glow-color: #3498db; 
            --is-dark-theme: 1; /* flag to help with date picker filter */
        }

        /* Ø§Ù„Ø«ÙŠÙ… 2: Ø§Ù„Ø¹Ù†Ø§Ø¨ÙŠ Ø§Ù„Ø£Ù†ÙŠÙ‚ (Elegant Maroon) */
        .theme-elegant-maroon {
            --primary-color: #8b0000; 
            --secondary-color: #1e8449; 
            --accent-color: #daa520; 
            --error-color: #c0392b; 
            --bg-color: #2e1a1a; 
            --text-color: #f0f0f0; 
            --container-bg: #4a2828; 
            --card-bg: #5a3232; 
            --table-header-bg: #6a4040;
            --table-row-hover: #503939;
            --button-shadow: 0 4px 15px rgba(139, 0, 0, 0.4);
            --glow-color: #c0392b;
            --is-dark-theme: 1;
        }
        
        /* Ø§Ù„Ø«ÙŠÙ… 3: Ø§Ù„ØºØ§Ø¨Ø§Øª Ø§Ù„Ù‡Ø§Ø¯Ø¦Ø© (Forest Green) */
        .theme-forest-green {
            --primary-color: #38a169; /* Ø£Ø®Ø¶Ø± ØºØ§Ø¨Ø© */
            --secondary-color: #63b3ed; /* Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ */
            --accent-color: #ecc94b; /* Ø°Ù‡Ø¨ÙŠ Ø¨Ø§Ù‡Øª */
            --error-color: #e53e3e; 
            --bg-color: #1a202c; /* ÙƒØ­Ù„ÙŠ Ø¯Ø§ÙƒÙ† */
            --text-color: #f7fafc; 
            --container-bg: #2d3748; 
            --card-bg: #4a5568; 
            --table-header-bg: #5a6275;
            --table-row-hover: #414a5c;
            --button-shadow: 0 4px 15px rgba(56, 161, 105, 0.4);
            --glow-color: #38a169;
            --is-dark-theme: 1;
        }

        /* Ø§Ù„Ø«ÙŠÙ… 4: Ø§Ù„ÙØ¬Ø± Ø§Ù„Ù…Ø´Ø±Ù‚ (Bright Dawn) - ÙØ§ØªØ­ */
        .theme-bright-dawn {
            --primary-color: #007bff; /* Ø£Ø²Ø±Ù‚ Ø³Ø§Ø·Ø¹ */
            --secondary-color: #28a745; /* Ø£Ø®Ø¶Ø± Ø·Ø¨ÙŠØ¹ÙŠ */
            --accent-color: #ffc107; /* Ø£ØµÙØ± Ø§Ù„Ø´Ù…Ø³ */
            --error-color: #dc3545; 
            --bg-color: #f8f9fa; /* Ø£Ø¨ÙŠØ¶ ÙØ§ØªØ­ */
            --text-color: #212529; /* Ù†Øµ Ø¯Ø§ÙƒÙ† */
            --container-bg: #e9ecef; /* Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ */
            --card-bg: #ffffff; /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨ÙŠØ¶Ø§Ø¡ */
            --table-header-bg: #dee2e6;
            --table-row-hover: #f1f3f5;
            --button-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
            --glow-color: #007bff;
            --is-dark-theme: 0;
        }
        
        /* Ø§Ù„Ø«ÙŠÙ… 5: Ø§Ù„Ù„ÙŠÙ„ Ø§Ù„Ù…ØªÙˆÙ‡Ø¬ (Vibrant Night) */
        .theme-vibrant-night {
            --primary-color: #9c27b0; /* Ø¨Ù†ÙØ³Ø¬ÙŠ ÙØ§ØªØ­ */
            --secondary-color: #00bcd4; /* Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ */
            --accent-color: #ffeb3b; /* Ø£ØµÙØ± Ù†ÙŠÙˆÙ† */
            --error-color: #f44336; 
            --bg-color: #0a0a1a; 
            --text-color: #e0f7fa; 
            --container-bg: #1c1a3b; 
            --card-bg: #2c2a50; 
            --table-header-bg: #3c3a70;
            --table-row-hover: #211f40;
            --button-shadow: 0 4px 15px rgba(156, 39, 176, 0.4);
            --glow-color: #00bcd4;
            --is-dark-theme: 1;
        }


        /* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙˆØ§Ù„Ù…Ø­Ø³Ù‘Ù† Ù„Ù„Ù‡Ø§ØªÙ */
    
        
        body 
        
        
        {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.5s, color 0.5s;
            font-size: 14px; 
        }

        .card-bg { background-color: var(--card-bg); }
        .container-bg { background-color: var(--container-bg); }
        .text-primary-color { color: var(--primary-color); }
        .text-secondary-color { color: var(--secondary-color); }
        .text-accent-color { color: var(--accent-color); }
        .btn-primary { 
            background-color: var(--primary-color); 
            box-shadow: var(--button-shadow); 
        }
        .btn-primary:hover { 
            opacity: 0.9; 
            transform: scale(1.02);
        }

        input, select, textarea {
            background-color: var(--container-bg);
            border: 1px solid var(--primary-color);
            color: var(--text-color);
            padding: 0.6rem; 
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ù„ÙˆÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø­Ø³Ø¨ Ø§Ù„Ø«ÙŠÙ… */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: var(--is-dark-theme) invert(1) brightness(1); /* Ù„ØªØ¹ÙƒØ³ Ø§Ù„Ù„ÙˆÙ† ÙÙŠ Ø§Ù„Ø«ÙŠÙ…Ø§Øª Ø§Ù„Ø¯Ø§ÙƒÙ†Ø© */
            opacity: 0.8;
            cursor: pointer;
        }
        /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„ÙØ§ØªØ­ (Bright Dawn) Ù„ÙƒÙŠ ØªÙƒÙˆÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø¯Ø§ÙƒÙ†Ø© */
        .theme-bright-dawn input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0); 
        }

        
        .table-header { background-color: var(--table-header-bg); }
        .table-row:hover { background-color: var(--table-row-hover); }

        .glow-text {
            color: var(--glow-color);
            font-family: 'Changa', sans-serif;
            font-weight: 700;
            text-shadow: 0 0 5px var(--glow-color), 0 0 10px var(--glow-color);
            animation: pulse-glow 3s infinite alternate;
        }

        @keyframes pulse-glow {
            from { opacity: 0.7; transform: scale(1); }
            to { opacity: 1; transform: scale(1.02); }
        }
        
        .tab-button {
            border-bottom: 3px solid transparent;
            color: var(--text-color);
            transition: all 0.3s;
        }
        .tab-button.active {
            color: var(--primary-color);
            border-color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-page {
            display: none;
        }
        
   

    </style>
</head>


   
    
    <!-- ====================================================================== -->
    <!-- Modal (Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø®ØµØµØ©) -->
    <!-- ====================================================================== -->
    
    <div id="customModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 hidden" onclick="window.hideModal()">
        <div id="modal-content" class="modal-content p-6 rounded-xl max-w-sm w-full mx-4 shadow-2xl" onclick="event.stopPropagation()" style="background-color: var(--card-bg);">
            <div id="modal-icon" class="text-4xl mb-4 text-center"></div>
            <h3 id="modal-title" class="text-xl font-bold mb-3 text-center" style="color: var(--primary-color);"></h3>
            <p id="modal-body" class="mb-6 text-center text-sm opacity-80"></p>
     <div class="flex justify-between space-x-2 rtl:space-x-reverse w-full gap-2">
    <button id="modal-cancel-btn" class="flex-1 px-4 py-2 rounded-lg bg-gray-500 hover:bg-gray-600 text-white transition font-bold hidden">
        Ø¥Ù„ØºØ§Ø¡
    </button>
    <button id="modal-confirm-btn" class="flex-1 px-4 py-2 rounded-lg text-white transition font-bold"></button>
</div>
        </div>
    </div>

    <!-- ====================================================================== -->
    <!-- Ø§Ù„Ù‚Ø³Ù… 3: Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© (Header) ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… -->
    <!-- ====================================================================== -->
    <header class="mb-4 p-4 rounded-xl shadow-lg container-bg">
        <div class="flex flex-col md:flex-row justify-between items-center mb-3">
            <h1 class="text-2xl md:text-3xl font-extrabold tracking-wider text-primary-color mb-2 md:mb-0">
                ğŸ“Š Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø·Ø§Ù„Ø¨Ø§Øª
            </h1>

           

              
            
            
            <div class="text-sm text-right">
                <div id="datetime-display" class="font-bold text-lg text-secondary-color"></div>
                <div id="hijri-date-display" class="text-accent-color text-sm"></div>
            </div>
        </div>

      
        
        <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… (Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ - Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·) -->
        <div class="user-info-bar p-3 card-bg rounded-lg shadow-inner flex flex-col md:flex-row justify-between items-center">
            <div class="text-lg font-bold mb-2 md:mb-0" style="color: var(--text-color);">
                <i data-lucide="user-check" class="w-5 h-5 inline ml-1 text-primary-color"></i>
                <span class="text-primary-color">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</span> <span id="owner-name-display"></span>
            </div>
            <div class="text-base" style="color: var(--text-color);">
                <i data-lucide="phone" class="w-4 h-4 inline ml-1 text-secondary-color"></i>
                <span class="text-secondary-color">Ù‡Ø§ØªÙ:</span> <span id="owner-phone-display"></span>
            </div>
        </div>
    </header>

    

    <!-- ====================================================================== -->
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ (Tabs Navigation Bar) -->
    <!-- ====================================================================== -->
    <nav class="flex overflow-x-auto whitespace-nowrap card-bg rounded-t-xl shadow-lg p-1.5 mb-4">
        
     
        
        <button id="tab-dashboard" onclick="window.openTab('dashboardTab')" class="tab-button flex items-center justify-center flex-1 p-3">
            <i data-lucide="layout-dashboard" class="w-5 h-5 ml-1.5"></i>
            <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
        </button>
        <button id="tab-addStudent" onclick="window.openTab('addStudentTab')" class="tab-button flex items-center justify-center flex-1 p-3">
            <i data-lucide="user-plus" class="w-5 h-5 ml-1.5"></i>
            <span id="add-student-title">Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø·Ø§Ù„Ø¨</span>
        </button>
        <button id="tab-sections" onclick="window.openTab('sectionsTab')" class="tab-button flex items-center justify-center flex-1 p-3">
            <i data-lucide="list-checks" class="w-5 h-5 ml-1.5"></i>
            <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</span>
        </button>
        
    </nav>
    
    <!-- ====================================================================== -->
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© -->
    <!-- ====================================================================== -->
    <div class="flex flex-wrap items-center justify-between p-3 mb-4 rounded-xl card-bg shadow-md">
        <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div class="flex flex-wrap gap-2 mb-2 md:mb-0">
            <!-- Ø²Ø± Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            <button onclick="window.generateAndCopyMessage()" class="flex items-center space-x-1 rtl:space-x-reverse px-3 py-2 rounded-lg btn-primary text-white text-sm font-semibold transition duration-300">
                <i data-lucide="share-2" class="w-4 h-4"></i>
                <span>Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
            </button>
            
            <!-- Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙƒÙ…Ù„Ù -->
            <button onclick="window.downloadApp()" class="flex items-center space-x-1 rtl:space-x-reverse px-3 py-2 rounded-lg bg-yellow-600 hover:bg-yellow-700 text-white text-sm font-semibold transition duration-300">
                <i data-lucide="download" class="w-4 h-4"></i>
                <span>ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span>   
            </button>
            

        </div>


        <!-- ÙÙ„ØªØ± Ø§Ù„Ø«ÙŠÙ…Ø§Øª -->
        <div class="relative">
            <select id="theme-selector" onchange="window.changeTheme(this.value)" class="p-2 rounded-lg text-sm container-bg border-primary-color border focus:ring-2 focus:ring-primary-color cursor-pointer transition">
                <option value="default">Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ†)</option>
                <option value="elegant-maroon">Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø¹Ù†Ø§Ø¨ÙŠ Ø§Ù„Ø£Ù†ÙŠÙ‚</option>
                <option value="forest-green">Ø«ÙŠÙ… Ø§Ù„ØºØ§Ø¨Ø§Øª Ø§Ù„Ù‡Ø§Ø¯Ø¦Ø©</option>
                <option value="bright-dawn">Ø«ÙŠÙ… Ø§Ù„ÙØ¬Ø± Ø§Ù„Ù…Ø´Ø±Ù‚ (ÙØ§ØªØ­)</option>
                <option value="vibrant-night">Ø«ÙŠÙ… Ø§Ù„Ù„ÙŠÙ„ Ø§Ù„Ù…ØªÙˆÙ‡Ø¬</option>
            </select>
            
        </div>
       
    </div>


    <!-- ====================================================================== -->
    <!-- Ø§Ù„Ù‚Ø³Ù… 4: ØµÙØ­Ø§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (Tab Content) -->
    <!-- ====================================================================== -->
    <main class="lg:px-4">

    

        
        <!-- ØµÙØ­Ø© 1: Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„ (Dashboard) -->
        <div id="dashboardTab" class="tab-page">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
                
                <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù† (Ø§Ù„Ù…Ù„Ø®Øµ + Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…) -->
                <div class="lg:col-span-1 space-y-4">
                    
                    <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… (Ù„Ù„ØªØ¹Ø¯ÙŠÙ„) -->
                    <div class="card-bg p-4 rounded-xl shadow-lg">
                        <h2 class="text-xl font-bold mb-3 text-primary-color flex items-center">
                            <i data-lucide="user" class="w-5 h-5 ml-2"></i>
                            <span>Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ©</span>
                        </h2>
                        <div class="space-y-3">
                            <div>
                                <label for="owner-name-input" class="block text-sm font-medium mb-1" style="color: var(--text-color);">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…/Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</label>
                                <input type="text" id="owner-name-input" oninput="window.updateOwnerData()" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…" required
                                       class="w-full p-2 rounded-lg focus:ring-2 focus:ring-secondary-color">

                                       
                            </div>
                            <div>
                                <label for="owner-phone-input" class="block text-sm font-medium mb-1" style="color: var(--text-color);">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ùˆ Ø§Ù„Ù…Ø¹Ù„Ù…Ù‡</label>
                                <input type="tel" id="owner-phone-input" oninput="window.updateOwnerData()" placeholder="+20**********(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
                                       class="w-full p-2 rounded-lg focus:ring-2 focus:ring-secondary-color">

                            </div>
                            <p class="text-xs opacity-60 pt-2 text-right">
                                * ÙŠØªÙ… Ø­ÙØ¸ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
                            </p>
                        </div>

                         <footer class="mt-8 p-4 text-center w-full"> 
    
    <div class="social-icons-footer flex gap-4 justify-center mb-6 p-2 rounded-xl">
        
        
        
        <a href="https://linktr.ee/Marwanelnagar" target="_blank" title="Linktree" 
           class="w-10 h-10 flex items-center justify-center rounded-full 
                  bg-neutral-800 hover:bg-neutral-900 transition duration-300 transform hover:scale-110 
                  ring-2 ring-gray-600/50 shadow-md">
            <i class="fas fa-link text-white text-xl"></i> 
        </a>

    </div>
    
</footer>
                    </div>
                    
                    <!-- Ù…Ù„Ø®Øµ Ø¥Ø­ØµØ§Ø¦ÙŠ -->
                    <div class="card-bg p-4 rounded-xl shadow-lg">
                        <h2 class="text-xl font-bold mb-4 text-secondary-color flex items-center">
                            <i data-lucide="activity" class="w-5 h-5 ml-2"></i>
                            <span>Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø§Ù…</span>
                        </h2>
                        <div id="dashboard-summary" class="space-y-3">
                            <!-- ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© calculateAndRenderDashboard() -->
                        </div>
                    </div>
                </div>
                
                <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ (ÙŠØ£Ø®Ø° 3 Ø£Ø¹Ù…Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©) -->
                <div class="lg:col-span-3">
                    <div class="card-bg p-4 rounded-xl shadow-lg">
                        <h2 class="text-xl font-bold mb-4" style="color: var(--text-color); display: flex; align-items: center;">
                            <i data-lucide="users" class="w-5 h-5 ml-2 text-primary-color"></i>
                            <span id="students-table-title">Ø¬Ø¯ÙˆÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                            
                            <!-- Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
                            <div class="relative w-48 mr-auto">
                                <input type="text" id="search-input" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ..." class="w-full p-2 pr-10 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-accent-color">
                                <i data-lucide="search" class="w-4 h-4 absolute top-1/2 left-3 transform -translate-y-1/2 opacity-60"></i>
                            </div>
                        </h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y" style="border-color: var(--container-bg);">
                            <thead>
    <tr class="table-header text-xs uppercase tracking-wider text-gray-200">
        <th class="p-3 text-right font-bold">Ø§Ù„Ø§Ø³Ù…</th>
        <th class="p-3 text-right">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</th> 
        <th class="p-3 text-right">Ø§Ù„Ù‚Ø³Ù…</th>
        <th class="p-3 text-center">Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªÙˆØ§ØµÙ„</th> <th class="p-3 text-center">Ø§Ù„Ø¹Ù…Ø±</th> 
        <th class="p-3 text-right">Ø§Ù„Ù…Ø¨Ù„Øº</th>
        <th class="p-3 text-center">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
        <th class="p-3 text-right">Ø¢Ø®Ø± Ø¯ÙØ¹</th>
        <th class="p-3 text-center">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
    </tr>
</thead>
                                <tbody id="students-table-body" class="divide-y" style="border-color: var(--container-bg);">
                                    <!-- ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© renderTable() -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- ØµÙØ­Ø© 2: Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ (Add Student) -->
        <div id="addStudentTab" class="tab-page">
            <div id="studentFormCard" class="card-bg p-4 rounded-xl shadow-lg max-w-2xl mx-auto">
                <h2 class="text-xl font-bold mb-4 text-primary-color flex items-center justify-center">
                    <i data-lucide="user-plus" class="w-6 h-6 ml-2"></i>
                    <span id="form-title">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨/Ø·Ø§Ù„Ø¨Ø© Ø¬Ø¯ÙŠØ¯</span>
                </h2>
                
                <form id="student-form" onsubmit="event.preventDefault(); window.saveStudent();">
                    <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ -->
                    <input type="hidden" id="student-id">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        <!-- Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø§Ø³Ù… - Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± -->
                        <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø·Ø§Ù„Ø¨/Ø©" required 
                               class="p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-color">
                        <input type="text" id="parentName" placeholder="Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" required 
                               class="p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-color">
                        
                        <!-- Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± - ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ -->
                        <input type="tel" id="parentPhone" placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ù„Ù„ØªÙˆØ§ØµÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" 
                               class="p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-color">
                        
                      <div class="form-group">
    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯: (ÙŠÙˆÙ… / Ø´Ù‡Ø± / Ø³Ù†Ø©)</label>
    <div style="display: flex; gap: 10px;">
        <input type="number" id="birthDay" placeholder="Ø§Ù„ÙŠÙˆÙ…" min="1" max="31"
            style="width: 30%;" class="w-full p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-color">
        <input type="number" id="birthMonth" placeholder="Ø§Ù„Ø´Ù‡Ø±" min="1" max="12"
            style="width: 30%;" class="w-full p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-color">
        <input type="number" id="birthYear" placeholder="Ø§Ù„Ø³Ù†Ø©" min="1900" max="2100"
            style="width: 40%;" class="w-full p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-color">
    </div>
</div>

                        <!-- Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© - Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø§Ù„Ø¨ -->
                        <div class="relative">
                            <select id="studyLevel"  
                                    class="w-full p-3 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-secondary-color">
                                <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</option>
                                <!-- ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                            </select>
                            <i data-lucide="chevron-down" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 pointer-events-none opacity-70"></i>
                        </div>

                        <input type="tel" id="studentContactPhone" placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ù„ØªÙˆØ§ØµÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" 
                               class="p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-color">

                        <!-- Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„Ù‚Ø³Ù…/Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© - Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø´Ù‡Ø±ÙŠ -->
                        <div class="relative">
                            <select id="section" required 
                                    class="w-full p-3 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-secondary-color">
                                <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…/Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
                            </select>
                            <i data-lucide="chevron-down" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 pointer-events-none opacity-70"></i>
                        </div>
                        <input type="number" id="monthly-fee" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹" min="0" step="any" required 
                               class="p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-color">



                                <label for="payment-method">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ (Payment Method): *</label>                      
                                          <select id="payment-method" required>
                                <option value="" disabled selected>-- Select Payment Method --</option>
                                 <option value="Cash">1. Cash</option>
                                 <option value="Instapay">2. Instapay</option>
                                 <option value="Vodafone Cash">3. Vodafone Cash</option>
                                 <option value="e& Cash">4. e& Cash</option>
                                 <option value="Orange Cash">5. Orange Cash</option>
                                 <option value="We Pay">6. We Pay</option>
                                 </select>
                        
                        <!-- Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³: ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø¯ÙØ¹ (Ø¹Ù…ÙˆØ¯ ÙƒØ§Ù…Ù„) -->
                        <div class="relative md:col-span-2">
                            <label for="last-payment-date" class="block text-xs font-medium opacity-70 mb-1" style="color: var(--text-color);">ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø¯ÙØ¹ *</label>
                            <input type="date" id="last-payment-date" required 
                                   class="w-full p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-color">
                        </div>
                        
                        <!-- Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³: Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ (Ø¹Ù…ÙˆØ¯ ÙƒØ§Ù…Ù„) -->
                        <div class="relative md:col-span-2">
                            <label for="studentMessage" class="block text-xs font-medium opacity-70 mb-1" style="color: var(--text-color);">Ø±Ø³Ø§Ù„Ø©/Ù…Ù„Ø§Ø­Ø¸Ø© Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <textarea id="studentMessage" rows="3" placeholder="Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø© Ø£Ùˆ Ø±Ø³Ø§Ø¦Ù„ Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø·Ø§Ù„Ø¨ Ù‡Ù†Ø§."
                                      class="w-full p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-color resize-y"></textarea>
                        </div>

                    </div>

                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
                    <div class="mt-6 flex flex-wrap gap-3 justify-center">
                        <button type="submit" id="save-btn" class="flex items-center px-6 py-3 rounded-xl btn-primary text-white font-bold transition duration-300">
                            <i data-lucide="save" class="w-5 h-5 ml-2"></i>
                            <span>Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù„Ø¨</span>
                        </button>
                        <button type="button" onclick="window.resetForm()" class="flex items-center px-6 py-3 rounded-xl bg-gray-500 hover:bg-gray-600 text-white font-bold transition duration-300">
                            <i data-lucide="rotate-ccw" class="w-5 h-5 ml-2"></i>
                            <span>Ø¥Ù„ØºØ§Ø¡ / Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- ØµÙØ­Ø© 3: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª (Sections) -->
        <div id="sectionsTab" class="tab-page">
            <div class="card-bg p-4 rounded-xl shadow-lg max-w-lg mx-auto">
                <h2 class="text-xl font-bold mb-4 text-accent-color flex items-center justify-center">
                    <i data-lucide="list-checks" class="w-6 h-6 ml-2"></i>
                    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</span>
                </h2>

                <!-- Ø­Ù‚Ù„ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯ + Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
                <div class="flex mb-4">
                    <input type="text" id="new-section-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯" class="flex-1 p-3 rounded-r-lg focus:outline-none focus:ring-2 focus:ring-primary-color">
                    <button onclick="window.addSection()" class="px-4 py-3 bg-secondary-color text-white rounded-l-lg hover:bg-green-600 transition duration-300">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                    </button>
                </div>

                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø±) -->
                <div id="sections-list" class="space-y-3 overflow-y-auto max-h-96 pr-2">
                    <!-- ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© renderSectionsList() -->
                </div>
            </div>
        </div>

    </main>
    
    <!-- ====================================================================== -->
    <!-- Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø¶ÙŠØ¦Ø© -->
    <!-- ====================================================================== -->
    <footer class="mt-8 p-4 text-center">
        <p class="glow-text text-lg md:text-xl">
            Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù‡Ø¯ÙŠØ© Ù…Ù† Ù…Ø±ÙˆØ§Ù† Ù‡Ø§Ù†ÙŠ Ø§Ù„Ù†Ø¬Ø§Ø± Ø§Ù„Ù‰ ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…- Marwan Hany EL-Nagar
        </p>

      


    <!-- ====================================================================== -->
    <!-- Ø§Ù„Ù‚Ø³Ù… 5: Ù…Ù†Ø·Ù‚ JavaScript -->
    <!-- ====================================================================== -->
    <script>
        // ======================================================================
        // A. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
        // ======================================================================
        let students = [];
        let sections = [];
        let nextStudentId = 1;
        let nextSectionId = 1; 
        let sortKey = 'name';
        let sortDirection = 1; 
        let currentFilterSectionId = 'all'; 
        let ownerData = { name: "", phone: "" }; 
        
        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø§Ù„Ø«Ø§Ø¨ØªØ©
        const STUDY_LEVELS = [
            'Ø­Ø¶Ø§Ù†Ø©',  'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 
            'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 
            'Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ', 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ', 
            'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ', 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ', 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ', 
            'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ', 'Ø¬Ø§Ù…Ø¹Ø©','Ø®Ø±ÙŠØ¬/Ù‡'
        ];

        /**
         * Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø± Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯
         * @param {string} dateString - ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ø¨ØµÙŠØºØ© YYYY-MM-DD
         * @returns {number} - Ø§Ù„Ø¹Ù…Ø± Ø¨Ø§Ù„Ø³Ù†ÙˆØ§Øª
         */
        function calculateAge(dateString) {
            if (!dateString) return 0;
            const dob = new Date(dateString);
            const now = new Date();
            let age = now.getFullYear() - dob.getFullYear();
            const monthDiff = now.getMonth() - dob.getMonth();
            
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙ…Ø± Ø´Ù‡Ø± Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ø¨Ø¹Ø¯ Ø£Ùˆ ÙƒØ§Ù† ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø´Ù‡Ø± ÙˆÙ„Ù… ÙŠÙ…Ø± ÙŠÙˆÙ… Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ø¨Ø¹Ø¯
            if (monthDiff < 0 || (monthDiff === 0 && now.getDate() < dob.getDate())) {
                age--;
            }
            return Math.max(0, age);
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ ØµÙŠØºØ© Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        const dateToInputString = (date) => {
            if (!date) return ''; 
            try {
                const d = new Date(date);
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            } catch (e) {
                return '';
            }
        }
        
        // ======================================================================
        // B. Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… (Owner Data) - ØªØ­Ø¯ÙŠØ« ÙˆØ­ÙØ¸ ÙÙˆØ±ÙŠ
        // ======================================================================
        
        function loadOwnerData() {
            const storedData = localStorage.getItem('ownerData');
            if (storedData) {
                ownerData = JSON.parse(storedData);
            } else {
                ownerData = { name: "", phone: "" }; 
            }
            updateOwnerDisplay();
            updateOwnerFormInputs();
        }

        function updateOwnerData() {
            const nameInput = document.getElementById('owner-name-input');
            const phoneInput = document.getElementById('owner-phone-input');
            
            const newName = nameInput ? nameInput.value.trim() : ownerData.name;
            const newPhone = phoneInput ? phoneInput.value.trim() : ownerData.phone;
            
            ownerData.name = newName;
            ownerData.phone = newPhone;
            
            localStorage.setItem('ownerData', JSON.stringify(ownerData));
            updateOwnerDisplay();
        }
        
        function updateOwnerFormInputs() {
            const nameInput = document.getElementById('owner-name-input');
            const phoneInput = document.getElementById('owner-phone-input');

            if (nameInput) nameInput.value = ownerData.name || '';
            if (phoneInput) phoneInput.value = ownerData.phone || '';
        }
        
        function updateOwnerDisplay() {
            const nameDisplay = document.getElementById('owner-name-display');
            const phoneDisplay = document.getElementById('owner-phone-display');

            if (nameDisplay) nameDisplay.textContent = ownerData.name || 'ØºÙŠØ± Ù…ÙØ¯Ø®Ù„';
            if (phoneDisplay) phoneDisplay.textContent = ownerData.phone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
        }


        // ======================================================================
        // C. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Local Storage - Ø¬Ù„Ø¨ ÙˆØ­ÙØ¸)
        // ======================================================================
        
        function loadData() {
            try {
                const storedStudents = localStorage.getItem('students');
                const storedSections = localStorage.getItem('sections');
                const storedNextId = localStorage.getItem('nextStudentId');
                const storedNextSectionId = localStorage.getItem('nextSectionId');

                students = storedStudents ? JSON.parse(storedStudents) : [];
                students = students.map(s => ({
                    ...s,
                    parentName: s.parentName || 'ØºÙŠØ± Ù…ÙØ¯Ø®Ù„', 
                    dateOfBirth: s.dateOfBirth || dateToInputString(new Date()), 
                    studyLevel: s.studyLevel || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                    parentPhone: s.parentPhone || s.phone || '', 
                    studentContactPhone: s.studentContactPhone || '',
                    studentMessage: s.studentMessage || '',
                }));
                students.forEach(s => delete s.phone); // ØªÙ†Ø¸ÙŠÙ Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

                // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ØªØ¨Ø¯Ø£ ÙØ§Ø±ØºØ© Ø­Ø³Ø¨ Ø·Ù„Ø¨ Ù…Ø±ÙˆØ§Ù†
                sections = storedSections ? JSON.parse(storedSections) : [];
                nextStudentId = storedNextId ? parseInt(storedNextId) : 1;
                nextSectionId = storedNextSectionId ? parseInt(storedNextSectionId) : 1; 

            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
                showMessage('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©.', 'error');
            }
        }

        function saveData() {
            localStorage.setItem('students', JSON.stringify(students));
            localStorage.setItem('sections', JSON.stringify(sections));
            localStorage.setItem('nextStudentId', nextStudentId.toString());
            localStorage.setItem('nextSectionId', nextSectionId.toString());
            
            renderSectionsList(); 
            renderTable(); 
            calculateAndRenderDashboard(); 
            renderSectionDropdown();
            renderStudyLevelDropdown(); 

            // ... Ø¯Ø§Ø®Ù„ Ø¯Ø§Ù„Ø© saveData() ...

    renderTable();
    calculateAndRenderDashboard();
    
    // â­ï¸ Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù‡Ù†Ø§ â­ï¸
    window.renderMonthlyRevenues(); // Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø¨Ø¹Ø¯ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ© Ø­ÙØ¸ (Ù…Ø«Ù„ Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹ Ø¬Ø¯ÙŠØ¯)
    
} // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¯Ø§Ù„Ø©
      
        
        // ======================================================================
        // D. Ù…Ù†Ø·Ù‚ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨ (CRUD)
        // ======================================================================
        
function saveStudent() {
            // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            const id = document.getElementById('student-id').value;
            const name = document.getElementById('name').value.trim();
            const parentName = document.getElementById('parentName').value.trim(); 
            const parentPhone = document.getElementById('parentPhone').value.trim(); 
            const studentContactPhone = document.getElementById('studentContactPhone').value.trim(); 
            const studyLevel = document.getElementById('studyLevel').value; 
            const sectionValue = document.getElementById('section').value;
            const sectionId = sectionValue ? parseInt(sectionValue) : 0; 
            
            // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
            const monthlyFeeInput = document.getElementById('monthly-fee').value;
            const monthlyFee = monthlyFeeInput ? parseFloat(monthlyFeeInput) : 0;
            
            const paymentMethod = document.getElementById('payment-method').value;
            const lastPaymentDate = document.getElementById('last-payment-date').value;
            const studentMessage = document.getElementById('studentMessage').value.trim(); 

            // 3. ØªØ¬Ù…ÙŠØ¹ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            const bDay = document.getElementById('birthDay').value.padStart(2, '0');
            const bMonth = document.getElementById('birthMonth').value.padStart(2, '0');
            const bYear = document.getElementById('birthYear').value;
            let dateOfBirth = ''; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙØ§Ø±ØºØ©

            // ÙŠØªÙ… ØªÙƒÙˆÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙ‚Ø· Ø¥Ø°Ø§ ØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø«Ù„Ø§Ø«Ø©
            if(bDay && bMonth && bYear && bDay !== '00' && bMonth !== '00') {
                dateOfBirth = `${bYear}-${bMonth}-${bDay}`;
            }

            // 4. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø± (Ø³ÙŠÙƒÙˆÙ† 0 Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¯Ø®Ù„ ØªØ§Ø±ÙŠØ®)
            const age = calculateAge(dateOfBirth);

            // 5. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªÙ… Ø¥Ø²Ø§Ù„Ø© !dateOfBirth Ù…Ù† Ù‡Ù†Ø§)
            // Ù„Ø§Ø­Ø¸ Ø£Ù†Ù†ÙŠ Ø­Ø°ÙØª Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ© Ù‡ÙŠ Ø§Ù„Ø§Ø³Ù…ØŒ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±ØŒ Ø§Ù„Ù…Ø±Ø­Ù„Ø©ØŒ ÙˆØ§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙÙ‚Ø·
            if (!name || !parentName || !studyLevel || isNaN(monthlyFee) || monthlyFee < 0 || !lastPaymentDate) {
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ø§Ù„Ø§Ø³Ù…ØŒ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±ØŒ Ø§Ù„Ù…Ø±Ø­Ù„Ø©ØŒ Ø§Ù„Ù…Ø¨Ù„ØºØŒ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹).', 'error');
                return;
            }

            const sectionName = sections.find(s => s.id === sectionId)?.name || 'ØºÙŠØ± Ù…ÙØ¹ÙŠÙ†';

            // 6. Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø·Ø§Ù„Ø¨
            const newStudent = {
                id: id ? parseInt(id) : nextStudentId,
                name,
                parentName, 
                parentPhone, 
                studentContactPhone, 
                dateOfBirth, // Ø³ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ Ù†Øµ ÙØ§Ø±Øº Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¯Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø´ÙŠØ¦Ø§Ù‹
                studyLevel, 
                age, 
                sectionId,
                sectionName,
                monthlyFee,
                paymentMethod, 
                lastPaymentDate: dateToInputString(new Date(lastPaymentDate)), 
                studentMessage, 
                createdAt: id ? students.find(s => s.id === parseInt(id))?.createdAt : new Date().toISOString()
            };

            // 7. Ø§Ù„Ø­ÙØ¸ Ø£Ùˆ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            if (id) {
                const index = students.findIndex(s => s.id === parseInt(id));
                if (index !== -1) {
                    students[index] = newStudent;
                    showMessage('Ù†Ø¬Ø§Ø­', `ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨/Ø©: ${name}`, 'success');
                }
            } else {
                students.push(newStudent);
                nextStudentId++;
                showMessage('Ù†Ø¬Ø§Ø­', `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨/Ø© Ø¬Ø¯ÙŠØ¯: ${name}`, 'success');
            }

            saveData();
            resetForm();
            openTab('dashboardTab'); 
        }
        

  function editStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;

            document.getElementById('add-student-title').textContent = `ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨: ${student.name}`;
            document.getElementById('form-title').textContent = `ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨/Ø©: ${student.name}`;
            document.getElementById('save-btn').innerHTML = '<i data-lucide="save" class="w-5 h-5 ml-2"></i><span>Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</span>';
            
            document.getElementById('student-id').value = student.id;
            document.getElementById('name').value = student.name;
            document.getElementById('parentName').value = student.parentName || ''; 
            document.getElementById('parentPhone').value = student.parentPhone || ''; 
            document.getElementById('studentContactPhone').value = student.studentContactPhone || ''; 
            
            // ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø«Ù„Ø§Ø«Ø©
            if (student.dateOfBirth) {
                const [year, month, day] = student.dateOfBirth.split('-');
                document.getElementById('birthDay').value = parseInt(day);
                document.getElementById('birthMonth').value = parseInt(month);
                document.getElementById('birthYear').value = parseInt(year);
            } else {
                document.getElementById('birthDay').value = '';
                document.getElementById('birthMonth').value = '';
                document.getElementById('birthYear').value = '';
            }
            
            document.getElementById('studyLevel').value = student.studyLevel || ''; 
            document.getElementById('section').value = student.sectionId || 0;
            document.getElementById('monthly-fee').value = student.monthlyFee;
            
            // ØªØµØ­ÙŠØ­ ØªØ¹Ø¨Ø¦Ø© Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
            if(student.paymentMethod) {
                document.getElementById('payment-method').value = student.paymentMethod;
            } else {
                document.getElementById('payment-method').value = ""; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            }

            document.getElementById('last-payment-date').value = dateToInputString(student.lastPaymentDate); 
            document.getElementById('studentMessage').value = student.studentMessage || ''; 
            
            openTab('addStudentTab');
            lucide.createIcons();
        }

        function deleteStudent(id) {
            showModal(
                'ØªØ­Ø°ÙŠØ± Ø­Ø°Ù', 
                'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨/Ø© Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.', 
                'error',
                () => {

                    
                    students = students.filter(s => s.id !== id);
                    saveData();
                    renderTable();
                    calculateAndRenderDashboard();
                    window.hideModal();
                    showMessage('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨/Ø© Ø¨Ù†Ø¬Ø§Ø­.', 'success');
                }
            );
        }

        function resetForm() {
            document.getElementById('student-form').reset();
            document.getElementById('student-id').value = '';
            
            document.getElementById('add-student-title').textContent = 'Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø·Ø§Ù„Ø¨';
            document.getElementById('form-title').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨/Ø·Ø§Ù„Ø¨Ø© Ø¬Ø¯ÙŠØ¯';
            document.getElementById('save-btn').innerHTML = '<i data-lucide="save" class="w-5 h-5 ml-2"></i><span>Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù„Ø¨</span>';
            
            document.getElementById('last-payment-date').value = dateToInputString(new Date());
            
            // ØªØµÙÙŠØ± Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            document.getElementById('birthDay').value = '';
            document.getElementById('birthMonth').value = '';
            document.getElementById('birthYear').value = '';
            
            renderSectionDropdown();
            renderStudyLevelDropdown();
            
            lucide.createIcons();
        }
        

        // ======================================================================
        // E. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Sections)
        // ======================================================================
        
        function addSection() {
            const name = document.getElementById('new-section-name').value.trim();
            if (!name) {
                showMessage('Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù„Ù„Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯.', 'warning');
                return;
            }
            if (sections.some(s => s.name === name)) {
                showMessage('Ø®Ø·Ø£', 'Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„.', 'warning');
                return;
            }
            
            sections.push({ id: nextSectionId, name: name });
            nextSectionId++;
            document.getElementById('new-section-name').value = '';
            saveData();
            showMessage('Ù†Ø¬Ø§Ø­', `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…: ${name}`, 'success');
        }

        function deleteSection(id) {
            const section = sections.find(s => s.id === id);
            if (!section) return;

            const studentsInSection = students.filter(s => s.sectionId === id).length;
            if (studentsInSection > 0) {
                showMessage('ØªØ­Ø°ÙŠØ±', `Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù‚Ø³Ù… "${section.name}" Ù„ÙˆØ¬ÙˆØ¯ ${studentsInSection} Ø·Ù„Ø§Ø¨ ÙÙŠÙ‡.`, 'error');
                return;
            }

            showModal(
                'Ø­Ø°Ù Ù‚Ø³Ù…',
                `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‚Ø³Ù… "${section.name}"ØŸ`,
                'warning',
                () => {
                    sections = sections.filter(s => s.id !== id);
                    saveData();
                    showMessage('Ù†Ø¬Ø§Ø­', `ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø³Ù…: ${section.name}`, 'success');
                }
            );
        }
        
        function renderSectionsList() {
            const list = document.getElementById('sections-list');
            list.innerHTML = '';
            
            // Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± Ø§Ù„ÙƒÙ„ (Ù„Ù„ÙÙ„ØªØ±Ø©)
            list.innerHTML += `
                <div onclick="window.filterBySection('all')" 
                     class="flex justify-between items-center p-3 rounded-lg cursor-pointer transition hover:bg-container-bg border-r-4 border-primary-color ${currentFilterSectionId === 'all' ? 'bg-container-bg' : 'bg-card-bg opacity-90'}">
                    <span class="font-bold text-lg">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ (Ø¨Ø¯ÙˆÙ† ØªØµÙÙŠØ©)</span>
                    <i data-lucide="filter" class="w-5 h-5 text-primary-color"></i>
                </div>
            `;
            
            sections.forEach(section => {
                const studentCount = students.filter(s => s.sectionId === section.id).length;
                const isCurrentFilter = currentFilterSectionId == section.id;
                
                list.innerHTML += `
                    <div class="flex justify-between items-center p-3 rounded-lg border-r-4 ${isCurrentFilter ? 'border-secondary-color bg-container-bg' : 'border-card-bg bg-card-bg opacity-90'}" style="border-color: ${isCurrentFilter ? 'var(--secondary-color)' : 'var(--card-bg)'};">
                        <div onclick="window.filterBySection(${section.id})" class="flex-1 cursor-pointer">
                            <span class="font-bold">${section.name}</span>
                            <span class="text-xs opacity-60 mr-2">(${studentCount} Ø·Ù„Ø§Ø¨)</span>
                        </div>
                        <button onclick="window.deleteSection(${section.id})" 
                                class="text-error-color hover:text-red-600 transition p-1 rounded-full">
                            <i data-lucide="x-circle" class="w-5 h-5"></i>
                        </button>
                    </div>
                `;
            });
            lucide.createIcons();
        }

        /**
         * ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
         */
        function renderSectionDropdown() {
            const select = document.getElementById('section');
            const currentValue = select.value;
            select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…/Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>';
            
            select.innerHTML += '<option value="0">ØºÙŠØ± Ù…ÙØ¹ÙŠÙ†</option>'; 

            sections.forEach(section => {
                const option = document.createElement('option');
                option.value = section.id;
                option.textContent = section.name;
                select.appendChild(option);
            });
            
            if (currentValue) {
                select.value = currentValue;
            }
        }
        
        /**
         * ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© (Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
         */
        function renderStudyLevelDropdown() {
            const select = document.getElementById('studyLevel');
            const currentValue = select.value;
            select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</option>';
            
            STUDY_LEVELS.forEach(level => {
                const option = document.createElement('option');
                option.value = level;
                option.textContent = level;
                select.appendChild(option);
            });
            
            if (currentValue) {
                select.value = currentValue;
            }
        }

        // ======================================================================
        // F. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„ÙØ±Ø² ÙˆØ§Ù„ØªØµÙÙŠØ©
        // ======================================================================
        
        function filterBySection(sectionId) {
            currentFilterSectionId = sectionId;
            renderTable();
            renderSectionsList(); 
            openTab('dashboardTab'); 
        }

        /**
         * ØªÙˆÙ„ÙŠØ¯ ÙˆØ¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨
         */
   function renderTable() {
            const tableBody = document.getElementById('students-table-body');
            const titleElement = document.getElementById('students-table-title');
            
            tableBody.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            
            const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
            let filteredStudents = students;

            // 1. ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø± (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù„Ø§Ù‹)
            if (typeof currentFilterMonth !== 'undefined' && currentFilterMonth !== 'all') {
                filteredStudents = filteredStudents.filter(s => s.lastPaymentDate && s.lastPaymentDate.startsWith(currentFilterMonth));
            }

            // 2. ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
            if (currentFilterSectionId !== 'all') {
                const filterId = parseInt(currentFilterSectionId);
                filteredStudents = filteredStudents.filter(s => (s.sectionId || 0) == filterId);
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            if (titleElement) {
                let titleText = 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨';
                if (typeof currentFilterMonth !== 'undefined' && currentFilterMonth !== 'all') {
                    titleText += ` (${currentFilterMonth})`;
                }
                titleElement.textContent = titleText;
            }

            // 3. ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
            if (searchTerm) {
                filteredStudents = filteredStudents.filter(student =>
                    (student.name || '').toLowerCase().includes(searchTerm) ||
                    (student.parentPhone || '').includes(searchTerm) ||
                    (student.studentContactPhone || '').includes(searchTerm)
                );
            }

            // 4. Ø§Ù„ÙØ±Ø²
            filteredStudents.sort((a, b) => {
                // (Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ø§Ù„ÙØ±Ø² Ø§Ù„Ø³Ø§Ø¨Ù‚)
                 let valA = a[sortKey]; let valB = b[sortKey];
                 if (sortKey === 'monthlyFee' || sortKey === 'age') { valA = parseFloat(valA) || 0; valB = parseFloat(valB) || 0; }
                 else { valA = String(valA || '').toLowerCase(); valB = String(valB || '').toLowerCase(); }
                 if (valA < valB) return -1 * sortDirection;
                 if (valA > valB) return 1 * sortDirection;
                 return 0;
            });

            if (filteredStudents.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="9" class="p-8 text-center text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.</td></tr>`;
                lucide.createIcons();
                return;
            }

            // 5. Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙÙˆÙ (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ù„ÙŠÙ…)
            filteredStudents.forEach(student => {
                const row = document.createElement('tr');
                row.className = 'table-row border-b border-gray-700 hover:bg-gray-800 transition duration-150';
                
                const sectionName = student.sectionName || sections.find(s => s.id === student.sectionId)?.name || 'ØºÙŠØ± Ù…ÙØ¹ÙŠÙ†';
                const age = calculateAge(student.dateOfBirth);
                
                // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‡ÙˆØ§ØªÙ
                const pPhone = student.parentPhone ? `<div class="text-xs text-gray-400">ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ${student.parentPhone}</div>` : '';
                const sPhone = student.studentContactPhone ? `<div class="text-xs text-blue-400">Ø§Ù„Ø·Ø§Ù„Ø¨: ${student.studentContactPhone}</div>` : '';
                const phonesContent = (pPhone || sPhone) ? (pPhone + sPhone) : '<span class="text-gray-500 text-xs">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>';

                // Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¯ÙØ¹
                let paymentBadgeColor = 'bg-gray-600';
                if(student.paymentMethod === 'Cash') paymentBadgeColor = 'bg-green-600';
                else if(student.paymentMethod === 'Vodafone Cash') paymentBadgeColor = 'bg-red-600';
                else if(student.paymentMethod === 'Instapay') paymentBadgeColor = 'bg-purple-600';

                row.innerHTML = `
                    <td class="p-3 font-bold text-white">${student.name}</td>
                    <td class="p-3 text-sm text-gray-300">${student.studyLevel || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td> 
                    <td class="p-3 text-sm"><span class="px-2 py-1 rounded bg-gray-700 text-xs">${sectionName}</span></td>
                    <td class="p-3 text-center">${phonesContent}</td>
                    <td class="p-3 text-center text-sm font-medium"><span class="text-yellow-500">${age}</span> Ø³Ù†Ø©</td> 
                    <td class="p-3 text-right font-bold text-green-400">${(student.monthlyFee || 0).toFixed(2)}</td>
                    <td class="p-3 text-center"><span class="px-2 py-1 rounded text-[10px] text-white ${paymentBadgeColor}">${student.paymentMethod || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></td> 
                    <td class="p-3 text-right text-xs text-gray-400 font-mono">${student.lastPaymentDate}</td>
                    
                    <td class="p-3 text-center">
                        <div class="flex justify-center items-center gap-3">
                            <button onclick="window.editStudent(${student.id})" class="p-2 rounded-full bg-blue-500/10 text-blue-400 hover:bg-blue-500 hover:text-white transition" title="ØªØ¹Ø¯ÙŠÙ„">
                                <i data-lucide="pen-line" class="w-4 h-4"></i>
                            </button>
                            <button onclick="window.deleteStudent(${student.id})" class="p-2 rounded-full bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white transition" title="Ø­Ø°Ù">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            lucide.createIcons();
        }

        function sortTable(key) {
            if (sortKey === key) {
                sortDirection *= -1;
            } else {
                sortKey = key;
                sortDirection = 1; 
            }
            renderTable();
        }
        
        // ======================================================================
        // G. Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (Dashboard Calculation)
        // ======================================================================

        function calculateAndRenderDashboard() {
            const totalStudents = students.length;
            const totalMonthlyFee = students.reduce((sum, s) => sum + (s.monthlyFee || 0), 0);
            
            const summaryHtml = `
                <div class="p-3 rounded-lg card-bg flex justify-between items-center border-r-4 border-primary-color" style="color: var(--text-color);">
                    <span class="opacity-70">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                    <span class="text-xl font-bold text-primary-color">${totalStudents}</span>
                </div>
                <div class="p-3 rounded-lg card-bg flex justify-between items-center border-r-4 border-secondary-color" style="color: var(--text-color);">
                    <span class="opacity-70">Ø¥ÙŠØ±Ø§Ø¯ Ø´Ù‡Ø±ÙŠ Ù…ÙÙ‚Ø¯Ø±</span>
                    <span class="text-xl font-bold text-secondary-color">${totalMonthlyFee.toFixed(2)}</span>
                </div>
                <div class="p-3 rounded-lg card-bg flex justify-between items-center border-r-4 border-accent-color" style="color: var(--text-color);">
                    <span class="opacity-70">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</span>
                    <span class="text-xl font-bold text-accent-color">${sections.length}</span>
                </div>
            `;

            document.getElementById('dashboard-summary').innerHTML = summaryHtml;
        }

        // ======================================================================
        // H. Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (Utilities)
        // ======================================================================

        /**
         * ØªÙˆÙ„ÙŠØ¯ ÙˆÙ†Ø³Ø® Ø±Ø³Ø§Ù„Ø© ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„Ø© (Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
         */
        function generateAndCopyMessage() {
            let message = "ğŸ“ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø·Ø§Ù„Ø¨Ø§Øª\n";
            message += "=========================================\n\n";

            // 1. Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…
            if (ownerData && ownerData.name) {
                message += `ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…/Ø§Ù„Ù…Ø¹Ù„Ù…Ø©: ${ownerData.name}\n`;
                if (ownerData.phone) {
                    message += `ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${ownerData.phone}\n`;
                }
            } else {
                 message += `ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…/Ø§Ù„Ù…Ø¹Ù„Ù…Ø©: ØºÙŠØ± Ù…ÙØ¯Ø®Ù„Ø©\n`;
            }
            message += `ğŸ—“ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}\n`;
            message += "=========================================\n\n";
            
            // 2. Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø§Ù…
            const totalStudents = students.length;
            const totalMonthlyFee = students.reduce((sum, s) => sum + (s.monthlyFee || 0), 0);
            
            message += "ğŸ“ˆ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:\n";
            message += `  - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨: ${totalStudents}\n`;
            message += `  - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©: ${totalMonthlyFee.toFixed(2)} Ø¬Ù†ÙŠÙ‡\n\n`;

            // 3. ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ§Ù„Ø·Ù„Ø§Ø¨
            message += "ğŸ“š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…:\n";
            
            const allSectionsData = [
                ...sections
            ].sort((a, b) => a.name.localeCompare(b.name));
            
            if (students.some(s => !s.sectionId || s.sectionId === 0)) {
                allSectionsData.unshift({ id: 0, name: 'ØºÙŠØ± Ù…ÙØ¹ÙŠÙ†' });
            }
            
            if (allSectionsData.length === 0 && students.length > 0) {
                 allSectionsData.push({ id: 0, name: 'ØºÙŠØ± Ù…ÙØ¹ÙŠÙ†' });
            }

            allSectionsData.forEach(section => {
                const sectionStudents = students.filter(s => (s.sectionId || 0) === section.id);
                if (sectionStudents.length > 0) {
                    message += `\n**--- Ù‚Ø³Ù… ${section.name} (${sectionStudents.length} Ø·Ù„Ø§Ø¨) ---**\n`;
                    
                    sectionStudents.forEach((s) => {
                        const fee = s.monthlyFee ? s.monthlyFee.toFixed(2) : '0.00';
                        const age = calculateAge(s.dateOfBirth);

                        message += `\n`;
                        message += `  - ğŸ· Ø§Ù„Ø§Ø³Ù…: ${s.name}\n`;
                        message += `  - ğŸ§‘ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ${s.parentName || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}\n`;
                        message += `  - ğŸ“ Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ${s.parentPhone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}\n`;
                        message += `  - ğŸ“± Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø§Ù„Ø¨: ${s.studentContactPhone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}\n`; 
                        message += `  - ğŸ“ Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${s.studyLevel || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;
                        message += `  - ğŸ‚ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯: ${s.dateOfBirth || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} (Ø§Ù„Ø¹Ù…Ø±: ${age} Ø³Ù†Ø©)\n`;
                        message += `  - ğŸ’° Ø±Ø³ÙˆÙ… Ø´Ù‡Ø±ÙŠØ©: ${fee}\n`;
                        message += `ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${s.paymentMethod || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;                        message += `  - ğŸ“… Ø¢Ø®Ø± Ø¯ÙØ¹: ${s.lastPaymentDate}\n`;
                        if (s.studentMessage) { 
                            message += `  - ğŸ’¬ Ø±Ø³Ø§Ù„Ø©/Ù…Ù„Ø§Ø­Ø¸Ø©: ${s.studentMessage}\n`;
                        }
                    });
                }
            });
            
            if (students.length === 0) {
                message += "\nÙ„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨ Ù…Ø¯Ø®Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.";
            }

            message += "\n=========================================\n";
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(message).then(() => {
                    showMessage('ØªÙ… Ø§Ù„Ù†Ø³Ø®', 'ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø³Ù‚ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù…Ø´Ø§Ø±ÙƒØªÙ‡.', 'success');
                }).catch(err => {
                    fallbackCopyTextToClipboard(message);
                });
            } else {
                fallbackCopyTextToClipboard(message);
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© (Ù„Ø¨ÙŠØ¦Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù‚ÙŠØ¯Ø©)
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showMessage('ØªÙ… Ø§Ù„Ù†Ø³Ø®', 'ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø³Ù‚ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù…Ø´Ø§Ø±ÙƒØªÙ‡.', 'success');
                } else {
                    showMessage('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', 'ÙŠØ±Ø¬Ù‰ Ù†Ø³Ø® Ø§Ù„Ù†Øµ ÙŠØ¯ÙˆÙŠØ§Ù‹.', 'error');
                }
            } catch (err) {
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø®', 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ.', 'error');
            }
            document.body.removeChild(textArea);
        }

        // ======================================================================
        // I. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ© (UI Management)
        // ======================================================================
        
        function changeTheme(themeName) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø«ÙŠÙ…Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            document.body.className = document.body.className.replace(/theme-\S+/g, '').trim();
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯
            if (themeName !== 'default') {
                document.body.classList.add(`theme-${themeName}`);
            }
            localStorage.setItem('theme', themeName);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Lucide Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø£Ù„ÙˆØ§Ù†Ù‡Ø§
            lucide.createIcons(); 
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'default';
            const selector = document.getElementById('theme-selector');
            if (selector) selector.value = savedTheme;
            changeTheme(savedTheme);
        }

        function openTab(tabId) {
            document.querySelectorAll('.tab-page').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            const targetTab = document.getElementById(tabId);
            if (targetTab) {
                targetTab.style.display = 'block';
                const tabButtonId = `tab-${tabId.replace('Tab', '')}`;
                const tabButton = document.getElementById(tabButtonId);
                if (tabButton) tabButton.classList.add('active');
            }
            localStorage.setItem('activeTab', tabId);

            lucide.createIcons();
            if (tabId === 'dashboardTab') {
                renderTable();
                calculateAndRenderDashboard();
                updateOwnerFormInputs(); 
            }
            if (tabId === 'sectionsTab') {
                renderSectionsList();
            }
            if (tabId === 'addStudentTab') {
                renderStudyLevelDropdown();
                renderSectionDropdown();
            }
        }
        
        function showMessage(title, body, type = 'success', duration = 3000) {
            const modal = document.getElementById('customModal');
            const confirmBtn = document.getElementById('modal-confirm-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');
            
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').textContent = body;
            
            confirmBtn.style.display = 'none';
            cancelBtn.style.display = 'none';
            
            let icon = '';
            let confirmClass = '';
            
            if (type === 'success') {
                icon = 'âœ…';
                confirmClass = 'bg-secondary-color';
            } else if (type === 'error') {
                icon = 'âŒ';
                confirmClass = 'bg-error-color';
            } else if (type === 'warning') {
                icon = 'âš ï¸';
                confirmClass = 'bg-accent-color';
            }

            document.getElementById('modal-icon').textContent = icon;
            
            confirmBtn.textContent = 'Ø­Ø³Ù†Ø§Ù‹';
            confirmBtn.style.display = 'block';
            confirmBtn.className = `flex-1 px-4 py-2 rounded-lg text-white transition font-bold ${confirmClass}`;
            confirmBtn.onclick = window.hideModal;
            
            modal.classList.remove('hidden');

            // Ø¥Ø®ÙØ§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ
            setTimeout(window.hideModal, duration);
        }

        function showModal(title, body, type, onConfirm) {
            const modal = document.getElementById('customModal');
            const confirmBtn = document.getElementById('modal-confirm-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');

            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').textContent = body;
            
            let icon = 'â“';
            let confirmClass = 'bg-primary-color hover:bg-blue-600';
            
            if (type === 'error') {
                icon = 'ğŸ—‘ï¸';
                confirmClass = 'bg-error-color hover:bg-red-600';
            } else if (type === 'warning') {
                icon = 'âš ï¸';
                confirmClass = 'bg-accent-color hover:bg-yellow-600';
            }

            document.getElementById('modal-icon').textContent = icon;

            confirmBtn.textContent = 'ØªØ£ÙƒÙŠØ¯';
            confirmBtn.style.display = 'block';
            cancelBtn.style.display = 'block';
            confirmBtn.className = `flex-1 px-4 py-2 rounded-lg text-white transition font-bold ${confirmClass}`;
            
            confirmBtn.onclick = () => {
                onConfirm();
                window.hideModal();
            };
            cancelBtn.onclick = window.hideModal;

            modal.classList.remove('hidden');
        }

        function hideModal() {
            document.getElementById('customModal').classList.add('hidden');
            document.getElementById('modal-confirm-btn').onclick = null;
}
window.hideModal = hideModal;

        
        function updateDateTime() {
            const now = new Date();
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            
            const gregorianDate = now.toLocaleDateString('ar-EG', dateOptions);
            const time = now.toLocaleTimeString('ar-EG', timeOptions);
            
            const hijriDate = now.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                calendar: 'islamic-umalqura'
            });

            const datetimeDisplay = document.getElementById('datetime-display');
            const hijriDisplay = document.getElementById('hijri-date-display');

            if (datetimeDisplay) datetimeDisplay.textContent = `${gregorianDate} - ${time}`;
            if (hijriDisplay) hijriDisplay.textContent = `Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${hijriDate}`;
        }
        
        function downloadApp() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'Ø§Ø¯Ø§Ø±Ø© Ø·Ù„Ø§Ø¨ ÙˆØ·Ø§Ù„Ø¨Ø§Øª';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showMessage('ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„', 'ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙƒÙ…Ù„Ù "Ø¯Ø§Ø±Ø© Ø·Ù„Ø§Ø¨ ÙˆØ·Ø§Ù„Ø¨Ø§Øª".', 'success');
        }


        // ======================================================================
        // K. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Initializer)
        // ======================================================================
        window.onload = function() {
            // Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨Ø§Ù„Ù€ window
            window.openTab = openTab;
            window.editStudent = editStudent;
            window.deleteStudent = deleteStudent;
            window.sortTable = sortTable;
            window.changeTheme = changeTheme;
            window.generateAndCopyMessage = generateAndCopyMessage;
            window.addSection = addSection;
            window.deleteSection = deleteSection;
            window.resetForm = resetForm;
            window.filterBySection = filterBySection;
            window.showMessage = showMessage;
            window.showModal = showModal;
            window.hideModal = hideModal;
            window.downloadApp = downloadApp; 
            window.saveStudent = saveStudent; 
            window.updateOwnerData = updateOwnerData; 
            window.calculateAndRenderDashboard = calculateAndRenderDashboard;

        
    
    // ... [Ø¨Ø§Ù‚ÙŠ ÙƒÙˆØ¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©] ...
    
    // â­ï¸ ØªØ£ÙƒØ¯ Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¹Ù…Ù„ Ø¨Ø¹Ø¯ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¯Ø§Ù„Ø© dateToInputString â­ï¸
    
    // 8. Ø¶Ø¨Ø· ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø­Ù‚Ù„ "ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø¯ÙØ¹"
    const lastPaymentDateInput = document.getElementById('last-payment-date');
    
    // A. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø­Ù‚Ù„ ÙˆØ¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙ…Ø© Ù…Ø³Ø¨Ù‚Ø© ÙÙŠÙ‡
    if (lastPaymentDateInput && !lastPaymentDateInput.value) {
        
        // B. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© dateToInputString Ù„ØªØ­Ø¯ÙŠØ¯ Ù‚ÙŠÙ…Ø© Ø§Ù„ÙŠÙˆÙ…
        lastPaymentDateInput.value = dateToInputString(new Date());
    }
    
    // ... [Ø¨Ø§Ù‚ÙŠ ÙƒÙˆØ¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©] ...
};

            // 1. ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            loadOwnerData(); 
            
            // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ
            setInterval(updateDateTime, 1000);
            updateDateTime();

            // 3. ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù…
            loadData(); 
            
            // 4. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª
            renderSectionDropdown();
            renderStudyLevelDropdown(); 
            renderTable();
            calculateAndRenderDashboard();
            renderSectionsList();

            // â­ï¸ Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù‡Ù†Ø§ â­ï¸
            window.renderMonthlyRevenues(); // Ù„ØªØ¸Ù‡Ø± Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            
            // 5. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ù…Ø­ÙÙˆØ¸
            loadTheme();

            // 6. ÙØªØ­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            const activeTab = localStorage.getItem('activeTab') || 'dashboardTab';
            openTab(activeTab);
            
            // 7. Ø±Ø¨Ø· Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø¨Ø­Ø¯Ø« Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.addEventListener('keyup', renderTable);
            
            // 8. Ø¶Ø¨Ø· ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø­Ù‚Ù„ "ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø¯ÙØ¹"
            const lastPaymentDateInput = document.getElementById('last-payment-date');
            if (lastPaymentDateInput && !lastPaymentDateInput.value) {
               lastPaymentDateInput.value = dateToInputString(new Date());
            }
            
            lucide.createIcons();

          

        
    </script>
    
    

</body>

</html>